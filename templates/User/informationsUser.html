{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ruches</title>
    <link rel="stylesheet" type="text/css" href="{% static 'ProjetRuches/css/style.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
            integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
            crossorigin=""></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.css' rel='stylesheet' />

</head>
<body>
<div style="text-align: center">
    {% include "../Nav/top.html" %}
</div>
<ul class="navbarMenu">
    <li class="liNavBar"><a href="home">Accueil</a></li>
    <li class="liNavBar"><a class="active" href="informationsUser">Gestion capteurs</a></li>
    {% if user.is_authenticated %}
    <li class="liNavBar"><a href="afficherRuchers">Gestion Ruchers</a></li>
    <li class="liNavBar"><a href="afficherColonies">Gestion Colonies</a></li>
    <li class="right liNavBar"><a href="{% url 'logout' %}">Déconnexion</a></li>
    <li class="right liNavBar" style="height: 52px">
        <a href="/monCompte" style="padding-top: 0">
            {% if user.is_superuser %}
            <p style="margin-bottom: 0; font-size: 11pt">Bonjour {{ user.username }} (superuser)</p>
            {% else %}
            <p style="margin-bottom: 0; font-size: 11pt">Bonjour {{ user.username }}</p>
            {% endif %}
            Mon Compte
        </a>
    </li>
    {% if user.is_superuser %}
    <li class="right liNavBar"><a href="showUsersAdmin">Administration</a></li>
    {% endif %}
    {% else %}
    <li class="right liNavBar"><a href="{% url 'login' %}">Connexion</a></li>
    <li class="right liNavBar"><a href="inscription">Inscription</a></li>
    {% endif %}
</ul>
{% include "../Nav/navigation.html" %}
<div>
    <h2 style="color: #1C5F90">Liste Villes</h2>
    <br>
    <div style="padding-left: 7%;">
        <ul style="list-style-type: none">
            {% for r in ruchers %}
            <li>
                <div style="display: inline-block; font-size: 20pt"><img style="width: 30px" src="{% static 'ProjetRuches/images/placeholder.png' %}" alt="geoloc">&nbsp;{{ r.ville }}</div> <div onclick="show('colonies{{r.ville}}')" style="display: inline-block; cursor: pointer; color: #007bff;" id="detailsVille">details</div>
                <div style="padding-left: 2%; display: none;" id="colonies{{r.ville}}">
                {% for cap in capteurs %}
                {% if cap.rucher == r.ville %}
                <p>● {{ cap.colonie }} <a href="{% url 'detailsUser' cap.id %}">Capteurs</a>&nbsp;<a href="{% url 'videoCameraUser' cap.id %}">Caméra</a></p>
                {% endif %}
                {% endfor %}
                </div>
            </li>
            <br>
            {% endfor %}
        </ul>
    </div>
    <div id='map'></div>
</div>
<script type="text/javascript">
    mapboxgl.accessToken = 'pk.eyJ1IjoiZGJ1cnZlbmkiLCJhIjoiY2p3MHJ6NHNvMDJuaTN5bHVybjN5ZjZsMSJ9.sUb-dIskcJ9PA7u0wb638g';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        zoom: 11.15,
        center: [2.2683334350585938, 48.815130004502386]
    });
    map.addControl(new mapboxgl.NavigationControl());


    function show(indice)
    {
        if (document.getElementById(indice).style.display==="none")		// Si la zone indiqué par indice est est invisible
            document.getElementById(indice).style.display="block";		// On l'affiche
        else									// Sinon (elle est donc visible)
            document.getElementById(indice).style.display="none";		//On la crend invisible
    }
    var marker = new mapboxgl.Marker({
        draggable: true
    })
    .setLngLat([0, 0])
    .addTo(map);

    function onDragEnd() {
        var lngLat = marker.getLngLat();
        coordinates.style.display = 'block';
        coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
    }

marker.on('dragend', onDragEnd);
</script>
</body>
</html>